<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista list de Grupos -->
    <record id="view_group_list" model="ir.ui.view">
        <field name="name">benglish.group.list</field>
        <field name="model">benglish.group</field>
        <field name="arch" type="xml">
            <list string="Grupos">
                <field name="code" />
                <field name="name" />
                <field name="subject_id" />
                <!--<field
                name="level_id" />-->
                <field name="delivery_mode" widget="badge"
                    decoration-success="delivery_mode == 'presential'"
                    decoration-info="delivery_mode == 'virtual'"
                    decoration-warning="delivery_mode == 'hybrid'" />
                <field name="campus_id" />
                <field name="subcampus_id" />
                <field name="teacher_id" widget="many2one_avatar_user" />
                <field name="current_presential" optional="show" string="Presenciales" />
                <field name="current_virtual" optional="show" string="Remotos" />
                <field name="current_students" />
                <field name="total_capacity" string="Cap. Total" />
                <field name="available_seats" />
                <field name="state" widget="badge"
                    decoration-info="state == 'draft'"
                    decoration-primary="state == 'confirmed'"
                    decoration-success="state == 'in_progress'"
                    decoration-muted="state == 'finished'"
                    decoration-danger="state == 'cancelled'" />
            </list>
        </field>
    </record>

    <!-- Vista Form de Grupos -->
    <record id="view_group_form" model="ir.ui.view">
        <field name="name">benglish.group.form</field>
        <field name="model">benglish.group</field>
        <field name="arch" type="xml">
            <form string="Grupo">
                <header>
                    <button name="%(action_generate_sessions_wizard_from_group)d" type="action"
                        string="üóìÔ∏è Generar Sesiones" class="btn-success"
                        invisible="state in ('finished', 'cancelled')"
                        groups="benglish_academy.group_academic_coordinator,benglish_academy.group_academic_manager" />
                    <button name="action_confirm" type="object" string="Confirmar"
                        class="oe_highlight" invisible="state != 'draft'" />
                    <button name="action_start" type="object" string="Iniciar"
                        class="oe_highlight" invisible="state != 'confirmed'" />
                    <button name="action_finish" type="object" string="Finalizar"
                        invisible="state != 'in_progress'" />
                    <button name="action_cancel" type="object" string="Cancelar"
                        invisible="state in ('finished', 'cancelled')" />
                    <button name="action_draft" type="object" string="Volver a Borrador"
                        invisible="state not in ('confirmed', 'cancelled')" />
                    <field name="state" widget="statusbar"
                        statusbar_visible="draft,confirmed,in_progress,finished" />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_enrollments" type="object"
                            class="oe_stat_button" icon="fa-graduation-cap">
                            <field name="active_enrollment_count" widget="statinfo"
                                string="Matriculados" />
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Cancelado" bg_color="text-bg-danger"
                        invisible="state != 'cancelled'" />
                    <widget name="web_ribbon" title="Finalizado" bg_color="text-bg-success"
                        invisible="state != 'finished'" />
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only" />
                        <h1>
                            <field name="name" placeholder="Nombre del grupo" />
                        </h1>
                        <div class="o_row">
                            <span class="badge text-bg-primary">
                                <i class="fa fa-users" />
                                <field name="code" placeholder="C√≥digo" />
                            </span>
                        </div>
                    </div>
                    <group>
                        <group name="basic_info">
                            <field name="name" />
                            <field name="code" />
                            <field name="subject_id" />
                            <!-- <field name="level_id" />-->
                            <field name="course_id" />
                        </group>
                        <group name="delivery">
                            <field name="delivery_mode" widget="radio" />
                            <field name="meeting_platform" invisible="delivery_mode == 'presential'" />
                            <field name="meeting_link" widget="url"
                                invisible="delivery_mode == 'presential'"
                                placeholder="https://meet.google.com/xxx-xxxx-xxx" />
                        </group>
                    </group>
                    <group>
                        <group name="location">
                            <field name="campus_id" />
                            <field name="subcampus_id" invisible="delivery_mode == 'virtual'" />
                            <field name="teacher_id" widget="many2one_avatar_user" />
                        </group>
                        <group name="schedule">
                            <field name="start_date" />
                            <field name="end_date" />
                            <field name="schedule" placeholder="Ej: Lun-Mie-Vie 8:00-10:00" />
                        </group>
                    </group>
                    <group>
                        <group name="capacity" string="üìä Capacidad">
                            <field name="presential_capacity"
                                invisible="delivery_mode == 'virtual'" />
                            <field name="current_presential" readonly="1"
                                invisible="delivery_mode == 'virtual'" />
                            <field name="available_presential_seats" readonly="1"
                                invisible="delivery_mode == 'virtual'" />
                            <field name="virtual_capacity"
                                invisible="delivery_mode == 'presential'" />
                            <field name="current_virtual" readonly="1"
                                invisible="delivery_mode == 'presential'" />
                            <field name="available_virtual_seats" readonly="1"
                                invisible="delivery_mode == 'presential'" />
                            <separator string="Total" invisible="delivery_mode != 'hybrid'" />
                            <label for="current_students" string="Ocupaci√≥n Total"
                                invisible="delivery_mode != 'hybrid'" />
                            <div class="o_row" invisible="delivery_mode != 'hybrid'">
                                <field name="current_students" readonly="1" />
                                <span> / </span>
                                <field name="total_capacity" readonly="1" />
                                <span class="text-muted">estudiantes</span>
                            </div>
                            <field name="available_seats" readonly="1" string="Cupos disponibles"
                                invisible="delivery_mode == 'hybrid'" />
                            <div invisible="available_seats &gt; 0 or delivery_mode == 'hybrid'">
                                <span class="badge text-bg-danger">‚ö†Ô∏è Grupo completo</span>
                            </div>
                            <div invisible="available_seats &lt;= 0 or delivery_mode == 'hybrid'">
                                <span class="badge text-bg-success">‚úì Cupos disponibles</span>
                            </div>
                        </group>
                        <group name="info">
                            <!-- Espacio para informaci√≥n adicional -->
                        </group>
                    </group>
                    <notebook>
                        <page string="Notas" name="notes">
                            <field name="notes"
                                placeholder="Informaci√≥n adicional sobre el grupo..." />
                        </page>
                        <page string="Estudiantes" name="students">
                            <field name="enrollment_ids"
                                context="{'default_group_id': id}">
                                <list model="benglish.enrollment" string="Estudiantes" create="1"
                                    edit="1">
                                    <field name="student_id" widget="many2one_avatar_user" />
                                    <field name="enrollment_date" />
                                    <field name="state" widget="badge"
                                        decoration-info="state == 'active'"
                                        decoration-muted="state == 'completed'"
                                        decoration-danger="state == 'cancelled'"
                                        decoration-success="state == 'enrolled'" />
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter />
            </form>
        </field>
    </record>

    <!-- Vista Kanban de Grupos -->
    <record id="view_group_kanban" model="ir.ui.view">
        <field name="name">benglish.group.kanban</field>
        <field name="model">benglish.group</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" sample="1">
                <field name="code" />
                <field name="name" />
                <field name="subject_id" />
                <!-- <field name="level_id" />-->
                <field name="campus_id" />
                <field name="subcampus_id" />
                <field name="teacher_id" />
                <field name="current_students" />
                <field name="total_capacity" />
                <field name="available_seats" />
                <field name="state" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <i class="fa fa-users" />
                                        <field name="name" />
                                    </strong>
                                    <span class="badge text-bg-primary">
                                        <field name="code" />
                                    </span>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <div class="row">
                                    <div class="col-6">
                                        <i class="fa fa-graduation-cap" />
                                        <field name="subject_id" />
                                    </div>
                                    <div class="col-6">
                                        <i class="fa fa-signal" />
                                        <!-- <field name="level_id" />-->
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <i class="fa fa-building" />
                                        <field name="campus_id" />
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <i class="fa fa-door-open" />
                                        <field name="subcampus_id" />
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <i class="fa fa-user" />
                                        <field name="teacher_id" />
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-6">
                                        <i class="fa fa-user-plus" /> <field name="current_students" />
                                        /<field name="total_capacity" />
                                    </div>
                                    <div class="col-6">
                                        <t t-if="record.available_seats.raw_value &gt; 0">
                                            <span class="badge text-bg-success">
                                                <i class="fa fa-check" /> <field
                                                    name="available_seats" /> cupos </span>
                                        </t>
                                        <t t-else="">
                                            <span class="badge text-bg-danger">
                                                <i class="fa fa-times" /> Completo </span>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            <div class="o_kanban_record_bottom mt-2">
                                <div class="oe_kanban_bottom_left">
                                    <field name="state" widget="badge"
                                        decoration-info="state == 'draft'"
                                        decoration-primary="state == 'confirmed'"
                                        decoration-success="state == 'in_progress'"
                                        decoration-muted="state == 'finished'"
                                        decoration-danger="state == 'cancelled'" />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Vista Search de Grupos -->
    <record id="view_group_search" model="ir.ui.view">
        <field name="name">benglish.group.search</field>
        <field name="model">benglish.group</field>
        <field name="arch" type="xml">
            <search string="Buscar Grupos">
                <field name="name" />
                <field name="code" />
                <field name="subject_id" />
                <field name="campus_id" />
                <field name="teacher_id" />
                <separator />
                <filter name="draft" string="Borrador" domain="[('state', '=', 'draft')]" />
                <filter name="confirmed" string="Confirmado" domain="[('state', '=', 'confirmed')]" />
                <filter name="in_progress" string="En Progreso"
                    domain="[('state', '=', 'in_progress')]" />
                <filter name="finished" string="Finalizado" domain="[('state', '=', 'finished')]" />
                <separator />
                <filter name="active" string="Activo" domain="[('active', '=', True)]" />
                <filter name="inactive" string="Inactivo" domain="[('active', '=', False)]" />
                <separator />
                <group expand="0" string="Agrupar por">
                    <filter name="group_by_campus" string="Sede" context="{'group_by': 'campus_id'}" />
                    <filter name="group_by_subject" string="Asignatura"
                        context="{'group_by': 'subject_id'}" />
                    <filter name="group_by_teacher" string="Docente"
                        context="{'group_by': 'teacher_id'}" />
                    <filter name="group_by_state" string="Estado" context="{'group_by': 'state'}" />
                </group>
            </search>
        </field>
    </record>

    <!-- Acci√≥n de ventana para Grupos -->
    <record id="action_group" model="ir.actions.act_window">
        <field name="name">Grupos</field>
        <field name="res_model">benglish.group</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear un nuevo Grupo
            </p>
            <p>
                Los grupos representan conjuntos de estudiantes que toman clases juntos.
                Cada grupo est√° asociado a una asignatura, una sede/aula y un docente.
            </p>
        </field>
    </record>

</odoo>