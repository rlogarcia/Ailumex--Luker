<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <!-- ========================================== -->
        <!-- GRUPOS DE SEGURIDAD PARA DOCENTES          -->
        <!-- ========================================== -->

        <!-- 
            ARQUITECTURA DE SEGURIDAD:
            
            1. Solo Coordinadores y Administradores pueden marcar empleados como docentes
            2. Solo Coordinadores y Administradores pueden modificar datos de reunión
            3. Los docentes pueden ver su propia información pero no modificarla
            4. Asistentes pueden ver docentes pero no crearlos ni modificarlos
        -->

        <!-- Grupo: Gestión de Docentes -->
        <record id="group_teacher_manager" model="res.groups">
            <field name="name">Gestor de Docentes</field>
            <field name="category_id" eval="False"/>
            <field name="comment">Permite crear y gestionar docentes (marcar empleados como docentes
                y configurar sus datos académicos)</field>
        </record>

        <!-- ========================================== -->
        <!-- REGLAS DE REGISTRO (RECORD RULES)          -->
        <!-- ========================================== -->

        <!-- 
            HR.EMPLOYEE - Control de acceso para datos de docencia
            
            LÓGICA:
            - Todos los usuarios pueden VER empleados (regla base de hr)
            - Solo Coordinadores/Administradores pueden MODIFICAR campos de docencia
            - Los docentes pueden VER sus propios datos académicos
        -->

        <record id="hr_employee_teacher_read_all" model="ir.rule">
            <field name="name">Empleados: Todos pueden ver</field>
            <field name="model_id" ref="hr.model_hr_employee" />
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_academic_user'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="0" />
            <field name="perm_create" eval="0" />
            <field name="perm_unlink" eval="0" />
        </record>

        <record id="hr_employee_teacher_write_coordinator" model="ir.rule">
            <field name="name">Docentes: Coordinadores pueden gestionar</field>
            <field name="model_id" ref="hr.model_hr_employee" />
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_academic_coordinator'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="1" />
            <field name="perm_create" eval="1" />
            <field name="perm_unlink" eval="0" />
        </record>

        <record id="hr_employee_teacher_full_manager" model="ir.rule">
            <field name="name">Docentes: Administradores control total</field>
            <field name="model_id" ref="hr.model_hr_employee" />
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_academic_manager'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="1" />
            <field name="perm_create" eval="1" />
            <field name="perm_unlink" eval="1" />
        </record>

        <!-- ========================================== -->
        <!-- REGLAS PARA SESIONES ACADÉMICAS            -->
        <!-- ========================================== -->

        <!--
            ACADEMIC_SESSION - Control de asignación de docentes
            
            CRÍTICO: Solo Coordinadores/Administradores pueden:
            - Asignar docentes a sesiones
            - Modificar asignaciones existentes
            - Crear nuevas sesiones
        -->

        <record id="academic_session_teacher_read" model="ir.rule">
            <field name="name">Sesiones: Docentes ven sus propias sesiones</field>
            <field name="model_id" ref="model_benglish_academic_session" />
            <field name="domain_force">[('teacher_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_academic_teacher'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="0" />
            <field name="perm_create" eval="0" />
            <field name="perm_unlink" eval="0" />
        </record>

        <record id="academic_session_assistant_manage" model="ir.rule">
            <field name="name">Sesiones: Asistentes pueden crear y modificar</field>
            <field name="model_id" ref="model_benglish_academic_session" />
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_academic_assistant'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="1" />
            <field name="perm_create" eval="1" />
            <field name="perm_unlink" eval="0" />
        </record>

        <record id="academic_session_coordinator_full" model="ir.rule">
            <field name="name">Sesiones: Coordinadores control completo</field>
            <field name="model_id" ref="model_benglish_academic_session" />
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_academic_coordinator'))]" />
            <field name="perm_read" eval="1" />
            <field name="perm_write" eval="1" />
            <field name="perm_create" eval="1" />
            <field name="perm_unlink" eval="1" />
        </record>

        <!-- ========================================== -->
        <!-- ADVERTENCIAS DE SEGURIDAD                  -->
        <!-- ========================================== -->

        <!--
            ⚠️ IMPORTANTE:
            
            1. Las reglas de seguridad NO reemplazan las validaciones del modelo
            2. Los @api.constrains siguen siendo necesarios para integridad de datos
            3. El dominio dinámico en academic_session previene selección incorrecta
            4. Estas reglas solo controlan QUIÉN puede hacer operaciones
            5. Las validaciones controlan QUÉ operaciones son válidas
            
            FLUJO DE SEGURIDAD:
            Usuario → Permisos de Grupo → Record Rules → Validaciones de Modelo → Base de Datos
        -->

    </data>
</odoo>