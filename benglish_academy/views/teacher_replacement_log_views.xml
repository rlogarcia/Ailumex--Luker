<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Lista -->
        <record id="view_teacher_replacement_log_list" model="ir.ui.view">
            <field name="name">benglish.teacher.replacement.log.list</field>
            <field name="model">benglish.teacher.replacement.log</field>
            <field name="arch" type="xml">
                <list string="Historial de Reemplazos de Docente" create="0" delete="0" edit="0"
                      default_order="replaced_at desc">
                    <field name="replaced_at"/>
                    <field name="session_id"/>
                    <field name="campus_id"/>
                    <field name="original_teacher_id"/>
                    <field name="new_teacher_id"/>
                    <field name="replacement_type"/>
                    <field name="replaced_by_id"/>
                </list>
            </field>
        </record>

        <!-- Formulario -->
        <record id="view_teacher_replacement_log_form" model="ir.ui.view">
            <field name="name">benglish.teacher.replacement.log.form</field>
            <field name="model">benglish.teacher.replacement.log</field>
            <field name="arch" type="xml">
                <form string="Log de Reemplazo de Docente" create="0" delete="0">
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="display_name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group string="Sesión Afectada">
                                <field name="session_id" readonly="1"/>
                                <field name="subject_id" readonly="1"/>
                                <field name="campus_id" readonly="1"/>
                            </group>
                            <group string="Horario de la Sesión">
                                <field name="session_start_datetime" readonly="1"/>
                                <field name="session_end_datetime" readonly="1"/>
                            </group>
                        </group>
                        <group>
                            <group string="Cambio de Docente">
                                <field name="original_teacher_id" readonly="1" widget="many2one_avatar_user"/>
                                <field name="new_teacher_id" readonly="1" widget="many2one_avatar_user"/>
                                <field name="replacement_type" readonly="1"/>
                            </group>
                            <group string="Auditoría">
                                <field name="replaced_at" readonly="1"/>
                                <field name="replaced_by_id" readonly="1" widget="many2one_avatar_user"/>
                            </group>
                        </group>
                        <group string="Motivo del Reemplazo">
                            <field name="replacement_reason" readonly="1" nolabel="1"/>
                        </group>
                        <group string="Notas Adicionales" invisible="not notes">
                            <field name="notes" readonly="1" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Búsqueda/Filtros        -->
        <record id="view_teacher_replacement_log_search" model="ir.ui.view">
            <field name="name">benglish.teacher.replacement.log.search</field>
            <field name="model">benglish.teacher.replacement.log</field>
            <field name="arch" type="xml">
                <search string="Buscar Reemplazos">
                    <field name="session_id"/>
                    <field name="original_teacher_id"/>
                    <field name="new_teacher_id"/>
                    <field name="replaced_by_id"/>
                    <field name="replacement_reason"/>
                    
                    <filter name="filter_last_week" string="Última Semana"
                            domain="[('replaced_at', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter name="filter_last_month" string="Último Mes"
                            domain="[('replaced_at', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                    
                    <separator/>
                    <filter name="filter_type_single" string="Sesiones Individuales"
                            domain="[('replacement_type', '=', 'single')]"/>
                    <filter name="filter_type_future" string="Series Futuras"
                            domain="[('replacement_type', '=', 'future')]"/>
                    <filter name="filter_type_all" string="Todas las Sesiones"
                            domain="[('replacement_type', '=', 'all')]"/>
                    <filter name="filter_type_massive" string="Edición Masiva"
                            domain="[('replacement_type', '=', 'massive')]"/>
                    
                    <group expand="0" string="Agrupar Por">
                        <filter name="group_by_date" string="Fecha" context="{'group_by': 'replaced_at:day'}"/>
                        <filter name="group_by_campus" string="Sede" context="{'group_by': 'campus_id'}"/>
                        <filter name="group_by_original_teacher" string="Docente Anterior" context="{'group_by': 'original_teacher_id'}"/>
                        <filter name="group_by_new_teacher" string="Docente Nuevo" context="{'group_by': 'new_teacher_id'}"/>
                        <filter name="group_by_type" string="Tipo de Reemplazo" context="{'group_by': 'replacement_type'}"/>
                        <filter name="group_by_user" string="Usuario que Reemplazó" context="{'group_by': 'replaced_by_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Acción de Ventana       -->
        <record id="action_teacher_replacement_log" model="ir.actions.act_window">
            <field name="name">Historial de Reemplazos de Docente</field>
            <field name="res_model">benglish.teacher.replacement.log</field>
            <field name="view_mode">list,form</field>
            <field name="context">{
                'search_default_filter_last_month': 1,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay registros de reemplazos de docente
                </p>
                <p>
                    Este registro de auditoría se genera automáticamente cada vez que se reemplaza un docente en una sesión.
                </p>
            </field>
        </record>

    </data>
</odoo>
