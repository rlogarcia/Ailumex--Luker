<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- HU-CRM-07: Vista de evaluación en CRM Lead -->
        <record id="view_crm_lead_form_evaluation" model="ir.ui.view">
            <field name="name">crm.lead.form.evaluation</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form" />
            <field name="arch" type="xml">

                <!-- Agregar campos de evaluación en pestaña Información adicional -->
                <xpath expr="//page[@name='extra']" position="inside">
                    <group string="Programación de Evaluación" name="evaluation_group">
                        <group>
                            <field name="evaluation_date" />
                            <field name="evaluation_time" placeholder="14:30" />
                            <field name="evaluation_modality" />
                        </group>
                        <group>
                            <field name="evaluation_link"
                                invisible="evaluation_modality != 'virtual'" />
                            <field name="evaluation_address"
                                invisible="evaluation_modality != 'presencial'" />
                            <field name="calendar_event_id" readonly="1" />
                        </group>
                    </group>
                    <group>
                        <button name="action_schedule_evaluation"
                            type="object"
                            string="Confirmar y Crear Evento en Calendario"
                            class="oe_highlight"
                            icon="fa-calendar-check-o"
                            invisible="not evaluation_date or not evaluation_time" />
                    </group>
                </xpath>

                <!-- Agregar página de Evaluación en el notebook (pestaña separada) -->
                <xpath expr="//notebook" position="inside">
                    <page string="Evaluación" name="evaluation"
                        invisible="type == 'opportunity'">
                        <group>
                            <group string="Programación">
                                <field name="evaluation_date" />
                                <field name="evaluation_time" placeholder="14:30" />
                                <field name="evaluation_modality" />
                            </group>
                            <group string="Detalles">
                                <field name="evaluation_link"
                                    invisible="evaluation_modality != 'virtual'" />
                                <field name="evaluation_address"
                                    invisible="evaluation_modality != 'presencial'" />
                                <field name="calendar_event_id" readonly="1" />
                            </group>
                        </group>
                        <group>
                            <button name="action_schedule_evaluation"
                                type="object"
                                string="Confirmar y Crear Evento en Calendario"
                                class="oe_highlight"
                                icon="fa-calendar-check-o"
                                invisible="not evaluation_date or not evaluation_time" />
                        </group>
                        <separator string="Instrucciones" />
                        <div class="alert alert-info" role="alert">
                            <p>
                                <strong>Cómo programar una evaluación:</strong>
                            </p>
                            <ol>
                                <li>Complete la <strong>Fecha</strong> y <strong>Hora</strong> de la
                                    evaluación</li>
                                <li>Seleccione la <strong>Modalidad</strong> (Presencial, Virtual o
                                    Telefónica)</li>
                                <li>Si es virtual, ingrese el <strong>Link</strong> de la reunión</li>
                                <li>Si es presencial, ingrese la <strong>Dirección</strong></li>
                                <li>Haga clic en <strong>"Confirmar y Crear Evento en Calendario"</strong></li>
                            </ol>
                            <p class="mb-0">
                                <em>Se creará automáticamente un evento en su calendario y se
                                    enviará una actividad de seguimiento.</em>
                            </p>
                        </div>
                    </page>
                </xpath>

            </field>
        </record>

    </data>
</odoo>