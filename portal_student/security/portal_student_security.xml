<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Grupo portal - solo creación, no actualización -->
    <data noupdate="1">
        <record id="group_benglish_student" model="res.groups">
            <field name="name">Portal Estudiante Benglish</field>
            <field name="category_id" ref="base.module_category_website"/>
            <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
            <field name="comment">Acceso exclusivo al Portal del Estudiante de Benglish Academy</field>
        </record>
        <record id="alias_group_benglish_student" model="ir.model.data">
            <field name="module">benglish_student_portal</field>
            <field name="name">group_benglish_student</field>
            <field name="model">res.groups</field>
            <field name="res_id" ref="portal_student.group_benglish_student"/>
            <field name="noupdate" eval="True"/>
        </record>
    </data>

    <!-- Reglas de acceso y seguridad -->
    <data noupdate="0">
        <!-- Record rules para limitar los datos al estudiante autenticado -->
        <record id="rule_student_self" model="ir.rule">
            <field name="name">Portal: Ver solo mi ficha de estudiante</field>
            <field name="model_id" ref="benglish_academy.model_benglish_student"/>
            <field name="domain_force">['|', ('user_id', '=', user.id), ('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_enrollment_self" model="ir.rule">
            <field name="name">Portal: Ver solo mis matrículas</field>
            <field name="model_id" ref="benglish_academy.model_benglish_enrollment"/>
            <field name="domain_force">[('student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_group_self" model="ir.rule">
            <field name="name">Portal: Grupos de mis matrículas</field>
            <field name="model_id" ref="benglish_academy.model_benglish_group"/>
            <field name="domain_force">[('enrollment_ids.student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_session_self" model="ir.rule">
            <field name="name">Portal: Sesiones publicadas para estudiantes</field>
            <field name="model_id" ref="benglish_academy.model_benglish_class_session"/>
            <field name="domain_force">[('is_published', '=', True)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <!-- Agenda semanal del portal (solo registros propios) -->
        <record id="rule_weekly_plan_self" model="ir.rule">
            <field name="name">Portal: Plan semanal del estudiante</field>
            <field name="model_id" ref="portal_student.model_portal_student_weekly_plan"/>
            <field name="domain_force">[('student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_weekly_plan_line_self" model="ir.rule">
            <field name="name">Portal: Lineas de plan semanal propias</field>
            <field name="model_id" ref="portal_student.model_portal_student_weekly_plan_line"/>
            <field name="domain_force">[('plan_id.student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Congelamientos y solicitudes -->
        <record id="rule_freeze_period_self" model="ir.rule">
            <field name="name">Portal: Mis periodos de congelamiento</field>
            <field name="model_id" ref="benglish_academy.model_benglish_student_freeze_period"/>
            <field name="domain_force">[('student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_freeze_request_self" model="ir.rule">
            <field name="name">Portal: Solicitudes de congelamiento propias</field>
            <field name="model_id" ref="portal_student.model_portal_student_freeze_request"/>
            <field name="domain_force">[('student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_notification_view_self" model="ir.rule">
            <field name="name">Portal: Notificaciones vistas propias</field>
            <field name="model_id" ref="portal_student.model_portal_notification_view"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('portal_student.group_benglish_student'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
        </record>
    </data>
</odoo>
