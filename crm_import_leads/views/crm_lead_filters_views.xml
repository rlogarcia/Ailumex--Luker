<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- HU-CRM-10: Search view extendida con filtros dinámicos -->
        <record id="view_crm_lead_search_extended" model="ir.ui.view">
            <field name="name">crm.lead.search.extended</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_leads_filter" />
            <field name="arch" type="xml">
                <xpath expr="//search" position="inside">

                    <!-- Filtros personalizados HU-CRM-10 -->
                    <separator />
                    <filter name="my_leads" string="Mis Leads"
                        domain="[('user_id', '=', uid)]"
                        help="Leads asignados a mí" />

                    <filter name="my_team_leads" string="Leads de Mi Equipo"
                        domain="['|', '|', 
                                     ('user_id', '=', uid),
                                     ('user_id.employee_ids.parent_id.user_id', '=', uid),
                                     ('user_id.employee_ids.parent_id.parent_id.user_id', '=', uid)]"
                        help="Leads de mi equipo (jerarquía HR)" />

                    <filter name="my_company" string="Mi Filial"
                        domain="[('company_id', '=', company_id)]"
                        help="Leads de mi filial/sucursal actual" />

                    <filter name="unassigned" string="Sin Asignar"
                        domain="[('user_id', '=', False)]"
                        help="Leads sin responsable asignado" />

                    <separator />

                    <filter name="uncontactable" string="Incontactables"
                        domain="[('stage_id.name', '=', 'Incontactable')]"
                        help="Leads marcados como incontactables" />

                    <filter name="pending" string="Pendientes / Volver a llamar"
                        domain="[('stage_id.name', 'in', ['Pendiente', 'Volver a llamar'])]"
                        help="Leads pendientes de contacto" />

                    <filter name="evaluation_scheduled" string="Con Evaluación Programada"
                        domain="[('evaluation_date', '!=', False)]"
                        help="Leads con fecha de evaluación" />

                    <filter name="evaluation_today" string="Evaluación Hoy"
                        domain="[('evaluation_date', '=', context_today().strftime('%Y-%m-%d'))]"
                        help="Evaluaciones programadas para hoy" />

                    <separator />

                    <filter name="new_this_week" string="Nuevos Esta Semana"
                        domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"
                        help="Leads creados en los últimos 7 días" />

                    <filter name="high_score" string="Score Alto (≥60)"
                        domain="[('lead_score', '&gt;=', 60)]"
                        help="Leads con alta probabilidad de conversión" />

                    <separator />

                    <!-- Agrupación extendida -->
                    <group expand="0" string="Agrupar por">
                        <filter name="group_by_company" string="Filial"
                            context="{'group_by': 'company_id'}" />
                        <filter name="group_by_source" string="Fuente"
                            context="{'group_by': 'source_id'}" />
                        <filter name="group_by_campaign" string="Campaña"
                            context="{'group_by': 'campaign_id'}" />
                        <filter name="group_by_user" string="Responsable"
                            context="{'group_by': 'user_id'}" />
                        <filter name="group_by_team" string="Equipo"
                            context="{'group_by': 'team_id'}" />
                        <filter name="group_by_stage" string="Etapa"
                            context="{'group_by': 'stage_id'}" />
                        <filter name="group_by_profile" string="Perfil"
                            context="{'group_by': 'profile'}" />
                        <filter name="group_by_city" string="Ciudad"
                            context="{'group_by': 'city'}" />
                        <filter name="group_by_create_date" string="Fecha de Creación"
                            context="{'group_by': 'create_date:month'}" />
                    </group>

                </xpath>
            </field>
        </record>

        <!-- HU-CRM-10: Acciones de ventana con filtros pre-aplicados -->

        <!-- Acción 1: Mis Leads -->
        <record id="action_my_leads" model="ir.actions.act_window">
            <field name="name">Mis Leads</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">kanban,list,form,calendar,pivot,graph,activity</field>
            <field name="domain">[('type', '=', 'lead')]</field>
            <field name="context">{
                'search_default_my_leads': 1,
                'default_type': 'lead'
                }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crea un nuevo Lead
                </p>
                <p>
                    Aquí verás únicamente tus leads asignados.
                </p>
            </field>
        </record>

        <!-- Acción 2: Leads de Mi Equipo -->
        <record id="action_my_team_leads" model="ir.actions.act_window">
            <field name="name">Leads de Mi Equipo</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">kanban,list,form,calendar,pivot,graph,activity</field>
            <field name="domain">[('type', '=', 'lead')]</field>
            <field name="context">{
                'search_default_my_team_leads': 1,
                'default_type': 'lead'
                }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay leads en tu equipo
                </p>
                <p>
                    Vista de leads de tu equipo basada en jerarquía de Recursos Humanos.
                </p>
            </field>
        </record>

        <!-- Acción 3: Leads Incontactables -->
        <record id="action_uncontactable_leads" model="ir.actions.act_window">
            <field name="name">Leads Incontactables</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">list,form,kanban</field>
            <field name="domain">[('type', '=', 'lead')]</field>
            <field name="context">{
                'search_default_uncontactable': 1,
                'default_type': 'lead'
                }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay leads incontactables
                </p>
                <p>
                    Leads que han sido marcados como incontactables.
                </p>
            </field>
        </record>

        <!-- Acción 4: Evaluaciones de Hoy -->
        <record id="action_evaluations_today" model="ir.actions.act_window">
            <field name="name">Evaluaciones de Hoy</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">list,form,calendar</field>
            <field name="domain">[('type', '=', 'lead')]</field>
            <field name="context">{
                'search_default_evaluation_today': 1,
                'default_type': 'lead'
                }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay evaluaciones programadas para hoy
                </p>
                <p>
                    Vista de leads con evaluación programada para hoy.
                </p>
            </field>
        </record>

        <!-- Acción 5: Leads Sin Asignar -->
        <record id="action_unassigned_leads" model="ir.actions.act_window">
            <field name="name">Leads Sin Asignar</field>
            <field name="res_model">crm.lead</field>
            <field name="view_mode">list,form,kanban</field>
            <field name="domain">[('type', '=', 'lead')]</field>
            <field name="context">{
                'search_default_unassigned': 1,
                'default_type': 'lead'
                }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Todos los leads están asignados
                </p>
                <p>
                    Leads que requieren asignación a un responsable.
                </p>
            </field>
        </record>

        <!-- Menús HU-CRM-10 -->
        <menuitem id="menu_my_leads"
            name="Mis Leads"
            parent="crm.crm_menu_sales"
            action="action_my_leads"
            sequence="10"
            groups="crm_import_leads.group_asesor_comercial" />

        <menuitem id="menu_my_team_leads"
            name="Leads de Mi Equipo"
            parent="crm.crm_menu_sales"
            action="action_my_team_leads"
            sequence="15"
            groups="crm_import_leads.group_supervisor_comercial" />

        <menuitem id="menu_unassigned_leads"
            name="Sin Asignar"
            parent="crm.crm_menu_sales"
            action="action_unassigned_leads"
            sequence="20"
            groups="crm_import_leads.group_supervisor_comercial" />

        <menuitem id="menu_uncontactable_leads"
            name="Incontactables"
            parent="crm.crm_menu_sales"
            action="action_uncontactable_leads"
            sequence="25"
            groups="crm_import_leads.group_asesor_comercial" />

        <menuitem id="menu_evaluations_today"
            name="Evaluaciones de Hoy"
            parent="crm.crm_menu_sales"
            action="action_evaluations_today"
            sequence="30"
            groups="crm_import_leads.group_asesor_comercial" />

    </data>
</odoo>