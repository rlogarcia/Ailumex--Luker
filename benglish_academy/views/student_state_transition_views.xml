<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- List View -->
    <record id="view_student_state_transition_list" model="ir.ui.view">
        <field name="name">benglish.student.state.transition.list</field>
        <field name="model">benglish.student.state.transition</field>
        <field name="arch" type="xml">
            <list string="Transiciones de Estado de Perfil">
                <field name="sequence" widget="handle"/>
                <field name="estado_origen_id" string="Estado Origen"/>
                <field name="estado_destino_id" string="Estado Destino"/>
                <field name="es_automatica" string="Automática"/>
                <field name="trigger" string="Trigger" invisible="not es_automatica"/>
                <field name="requiere_motivo" string="Req. Motivo"/>
                <field name="requiere_aprobacion" string="Req. Aprobación"/>
                <field name="active" string="Activa"/>
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_student_state_transition_form" model="ir.ui.view">
        <field name="name">benglish.student.state.transition.form</field>
        <field name="model">benglish.student.state.transition</field>
        <field name="arch" type="xml">
            <form string="Configuración de Transición">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <span><field name="estado_origen_id" readonly="1" class="oe_inline"/></span>
                            <span class="mx-2">→</span>
                            <span><field name="estado_destino_id" readonly="1" class="oe_inline"/></span>
                        </h1>
                    </div>
                    <group>
                        <group string="Estados">
                            <field name="estado_origen_id" string="Estado Origen" 
                                options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="estado_destino_id" string="Estado Destino"
                                options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="sequence" string="Secuencia"/>
                            <field name="active" string="Activa"/>
                        </group>
                        <group string="Requisitos">
                            <field name="requiere_motivo" string="Requiere Motivo"/>
                            <field name="requiere_aprobacion" string="Requiere Aprobación"/>
                        </group>
                    </group>
                    <group>
                        <group string="Automatización">
                            <field name="es_automatica" string="Es Transición Automática"/>
                            <field name="trigger" string="Trigger Automático" 
                                invisible="not es_automatica"
                                required="es_automatica"/>
                        </group>
                        <group string="Permisos">
                            <field name="grupo_permitido_ids" string="Grupos Permitidos"
                                widget="many2many_tags"
                                options="{'no_create': True}"/>
                        </group>
                    </group>
                    <group string="Descripción" invisible="not descripcion">
                        <field name="descripcion" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_student_state_transition_search" model="ir.ui.view">
        <field name="name">benglish.student.state.transition.search</field>
        <field name="model">benglish.student.state.transition</field>
        <field name="arch" type="xml">
            <search string="Buscar Transiciones">
                <field name="estado_origen_id" string="Estado Origen"/>
                <field name="estado_destino_id" string="Estado Destino"/>
                <separator/>
                <filter name="filter_active" string="Activas" domain="[('active', '=', True)]"/>
                <filter name="filter_inactive" string="Inactivas" domain="[('active', '=', False)]"/>
                <separator/>
                <filter name="filter_automaticas" string="Automáticas" domain="[('es_automatica', '=', True)]"/>
                <filter name="filter_manuales" string="Manuales" domain="[('es_automatica', '=', False)]"/>
                <separator/>
                <filter name="filter_requiere_motivo" string="Requiere Motivo" domain="[('requiere_motivo', '=', True)]"/>
                <filter name="filter_requiere_aprobacion" string="Requiere Aprobación" domain="[('requiere_aprobacion', '=', True)]"/>
                <separator/>
                <group expand="0" string="Agrupar por">
                    <filter name="group_origen" string="Estado Origen" context="{'group_by': 'estado_origen_id'}"/>
                    <filter name="group_destino" string="Estado Destino" context="{'group_by': 'estado_destino_id'}"/>
                    <filter name="group_trigger" string="Trigger" context="{'group_by': 'trigger'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_student_state_transition" model="ir.actions.act_window">
        <field name="name">Transiciones de Estado</field>
        <field name="res_model">benglish.student.state.transition</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_student_state_transition_search"/>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configure las transiciones válidas del estado de perfil
            </p>
            <p>
                Defina qué cambios de estado de perfil están permitidos, si requieren motivo,
                aprobación, o si son automáticos basados en eventos del sistema.
            </p>
        </field>
    </record>

</odoo>
