<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- VISTA DE LISTA PARA BIT√ÅCORA ACAD√âMICA (usado en vista de estudiante) -->
    <record id="view_academic_history_tree_student" model="ir.ui.view">
        <field name="name">benglish.academic.history.tree.student</field>
        <field name="model">benglish.academic.history</field>
        <field name="arch" type="xml">
            <list string="Sesiones de Asignaturas"
                editable="bottom"
                decoration-success="attendance_status == 'attended' or attended == True"
                decoration-danger="attendance_status == 'absent'"
                decoration-muted="attendance_status == 'pending'">
                <field name="session_code" string="C√≥digo" readonly="1" />
                <field name="subject_id" string="Asignatura" readonly="1" />
                <field name="session_date" string="Fecha" readonly="1" optional="show" />
                <field name="attended" string="Asisti√≥ ‚úì" widget="boolean" />
                <field name="grade" string="Nota" optional="show" />
                <field name="teacher_id" string="Docente" readonly="1" optional="show" />
                <field name="novedad" string="Novedad" widget="badge" optional="hide" />
                <field name="notes" string="Observaciones" optional="hide" />
                <field name="attendance_status" column_invisible="1" />
                <field name="session_id" column_invisible="1" />
            </list>
        </field>
    </record>    <!--
    VISTA DE LISTA (list)  -->
    <record id="view_student_list" model="ir.ui.view">
        <field name="name">benglish.student.list</field>
        <field name="model">benglish.student</field>
        <field name="arch" type="xml">
            <list string="Estudiantes" sample="1">
                <field name="code" optional="show" />
                <field name="name" string="Nombre Completo" />
                <field name="email" optional="show" />
                <field name="mobile" optional="show" />
                <field name="program_id" optional="show" />
                <field name="current_level_id" optional="show" />
                <field name="max_unit_completed" string="Unidad M√°x. Completada" optional="show" />
                <field name="preferred_campus_id" optional="show" />
                <field name="academic_progress_percentage" optional="show" widget="progressbar" />
                <field name="active_enrollments" string="Matr√≠culas Activas" />
                <field name="completed_enrollments" optional="hide" />
                <field name="state" widget="badge"
                    decoration-success="state == 'active'"
                    decoration-info="state == 'enrolled'"
                    decoration-warning="state == 'inactive'"
                    decoration-muted="state == 'withdrawn'"
                    decoration-primary="state == 'graduated'" />
                <field name="active" invisible="1" />
            </list>
        </field>
    </record>

    <!-- VISTA DE FORMULARIO  -->
    <record id="view_student_form" model="ir.ui.view">
        <field name="name">benglish.student.form</field>
        <field name="model">benglish.student</field>
        <field name="arch" type="xml">
            <form string="Estudiante">
                <header>
                    <!-- Botones de estado -->
                    <button name="action_set_active" type="object" string="Activar"
                        invisible="state in ['active', 'graduated', 'withdrawn'] or not enrollment_ids"
                        groups="benglish_academy.group_academic_assistant" />

                    <!-- Bot√≥n para matricular con wizard paso a paso -->
                    <button name="%(action_enrollment_wizard_from_student)d" type="action"
                        string="Matricular"
                        class="oe_highlight"
                        invisible="state in ['withdrawn', 'graduated']" />

                    <button name="action_create_portal_user"
                        type="object"
                        string="Crear Usuario Portal"
                        class="btn-primary"
                        invisible="user_id"
                        groups="benglish_academy.group_academic_assistant,base.group_system" />

                    <button name="action_open_lifecycle_state_wizard" type="object"
                        string="Cambiar Estado"
                        class="oe_highlight"
                        groups="benglish_academy.group_academic_coordinator,benglish_academy.group_academic_manager" />

                    <button name="action_fix_portal_access"
                        type="object"
                        string="Corregir Acceso Portal"
                        class="btn-secondary"
                        invisible="not user_id"
                        groups="benglish_academy.group_academic_assistant,base.group_system" />
                    <button name="action_sync_to_partner"
                        type="object"
                        string="Sincronizar a Contacto"
                        class="btn-info"
                        invisible="not partner_id"
                        groups="benglish_academy.group_academic_assistant,base.group_system"
                        help="Actualiza el contacto con toda la informaci√≥n del estudiante" />

                    <!-- ‚≠ê Bot√≥n para recalcular KPIs de asistencia -->
                    <button name="action_recalculate_attendance_kpis" type="object"
                        string="üîÑ Recalcular Asistencia"
                        class="btn-secondary"
                        groups="benglish_academy.group_academic_assistant,base.group_system"
                        help="Recalcula los KPIs de asistencia (√∫til si hay inconsistencias en los datos)" />

                    <!-- Bot√≥n para eliminaci√≥n definitiva (solo administradores) -->
                    <button name="action_force_delete" type="object"
                        string="Eliminar Definitivamente"
                        confirm="¬øEst√° completamente seguro? Esta acci√≥n eliminar√° al estudiante y TODAS sus matr√≠culas permanentemente. No se puede deshacer."
                        invisible="not enrollment_ids"
                        groups="base.group_system"
                        class="btn-danger" />

                    <field name="state" widget="statusbar" readonly="1"
                        statusbar_visible="prospect,enrolled,active,graduated" />
                </header>

                <sheet>
                    <!-- Botones estad√≠sticos -->
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_enrollments" type="object"
                            class="oe_stat_button" icon="fa-book">
                            <field name="total_enrollments" widget="statinfo"
                                string="Matr√≠culas" />
                        </button>
                        <button name="%(action_enrollment_kanban)d" type="action"
                            class="oe_stat_button" icon="fa-graduation-cap">
                            <field name="completed_enrollments" widget="statinfo"
                                string="Completadas" />
                        </button>
                        <button name="action_view_freeze_periods" type="object"
                            class="oe_stat_button" icon="fa-pause-circle">
                            <field name="dias_congelamiento_usados" widget="statinfo"
                                string="D√≠as Cong." />
                        </button>
                        <button name="action_open_freeze_request_wizard" type="object"
                            class="oe_stat_button" icon="fa-plus-circle"
                            string="Solicitar Congelamiento" />
                    </div>

                    <!-- Imagen/Avatar -->
                    <field name="image_1920" widget="image" class="oe_avatar"
                        options="{'preview_image': 'image_128'}" invisible="1" />
                    <group>
                        <group>
                            <div class="oe_title">
                                <label for="name" string="Nombre del Estudiante" />
                                <h1>
                                    <field name="name" placeholder="ej: Juan P√©rez Garc√≠a"
                                        readonly="1" />
                                </h1>
                                <h3>
                                    <field name="code" placeholder="EST-2025-001" required="1" />
                                </h3>
                            </div>
                        </group>
                        <group name="responsible_info" string="Beneficiario">
                            <field name="responsible_is_emergency" widget="boolean_toggle"
                                options="{'terminology': {'string_true': 'S√≠', 'string_false': 'No', 'hover_true': 'Es Beneficiario', 'hover_false': 'No es Beneficiario'}}" />
                        </group>
                    </group>

                    <group>
                        <group name="personal_info" string="Informaci√≥n Personal">
                            <field name="first_name" placeholder="Primer nombre" required="1" />
                            <field name="second_name" placeholder="Segundo nombre (opcional)" />
                            <field name="first_last_name" placeholder="Primer apellido" required="1" />
                            <field name="second_last_name" placeholder="Segundo apellido (opcional)" />
                            <field name="id_type_id" string="Tipo de Documento"
                                options="{'no_open': True, 'no_create': True}"
                                placeholder="C√©dula, Tarjeta de Identidad, etc." />
                            <field name="student_id_number" />
                            <field name="birth_date" />
                            <field name="age" />
                            <field name="gender" />
                        </group>
                        <!--<group
                        name="academic_info" string="ESTRUCTURA ACAD√âMICA">
                            <div class="alert alert-info mb-2" colspan="2"
                                style="padding: 8px; margin-bottom: 8px;">
                                <small>
                                    <i class="fa fa-info-circle" /> Esta informaci√≥n se actualiza <strong>
                                    autom√°ticamente</strong> al aprobar matr√≠culas. </small>
                            </div>
                            <field name="program_id" readonly="1"
                                placeholder="Se asigna al aprobar matr√≠cula" />
                            <field name="plan_id" readonly="1"
                                placeholder="Se asigna al aprobar matr√≠cula" />
                            <field name="current_phase_id" readonly="1"
                                placeholder="Calculado desde matr√≠culas activas" />
                            <field name="current_level_id" readonly="1"
                                placeholder="Calculado desde matr√≠culas activas" />
                            <field name="max_unit_completed" readonly="1"
                                placeholder="Calculado desde historial acad√©mico" />
                            <field name="current_subject_id" readonly="1"
                                placeholder="Calculado desde matr√≠culas activas" />
                        </group>
                        <group name="academic_progress" string="üìä PROGRESO ACAD√âMICO">
                            <field name="academic_progress_percentage" widget="progressbar"
                                readonly="1" />
                            <field name="completed_hours" readonly="1" />
                            <field name="total_plan_hours" readonly="1" />
                        </group>-->

                        <group name="contact_info"
                            string="Informaci√≥n de Contacto / Preferencias acad√©micas">
                            <field name="email" widget="email" />
                            <field name="mobile" widget="phone" />
                            <field name="city" placeholder="Ciudad" options="{'no_create': True}" />
                            <field name="country_id" placeholder="Pa√≠s" />
                            <field name="address" placeholder="Calle, n√∫mero, barrio..." />
                        </group>
                        <group name="academic_info" string="Informaci√≥n del Plan">
                            <field name="program_id" string="Programa"
                                placeholder="Selecciona el programa del estudiante"
                                options="{'no_create': True}" />
                            <field name="plan_id" string="Plan de Estudio"
                                placeholder="Selecciona el plan de estudio"
                                options="{'no_create': True}"
                                domain="[('program_id', '=', program_id)]" />
                            <field name="preferred_campus_id" string="Sede Principal" />
                            <field name="preferred_delivery_mode" string="Modalidad Preferida"
                                widget="radio"
                                options="{'horizontal': true}" />
                            <field name="enrollment_date" string="Fecha de Ingreso" />
                        </group>
                    </group>

                    <notebook>
                        <!-- P√°gina de Matr√≠culas en Curso -->
                        <page name="active_enrollments" string="üìö Matr√≠culas en Curso">
                            <field name="active_enrollment_ids" nolabel="1">
                                <list string="Matr√≠culas en Curso"
                                    decoration-success="state == 'in_progress'">
                                    <field name="code" />
                                    <field name="subject_id" />
                                    <field name="group_id" />
                                    <field name="campus_id" />
                                    <field name="delivery_mode" widget="badge" />
                                    <field name="attendance_type" widget="badge" />
                                    <field name="start_date" />
                                    <field name="end_date" />
                                    <field name="state" widget="badge" />
                                </list>
                            </field>
                        </page>

                        <!-- RF-03: Historia Acad√©mica Completa -->
                        <page name="academic_history" string="üìñ Historia Acad√©mica">
                            <!-- KPIs Resumen -->
                            <div class="row mt16">
                                <div class="col-md-12">
                                    <div class="alert alert-info" role="alert">
                                        <strong>Historia Acad√©mica Completa:</strong> Resumen
                                        ejecutivo, estructura del plan, avance por asignatura,
                                        asistencia y l√≠nea de tiempo. </div>
                                </div>
                            </div>

                            <notebook>
                                <!-- Tab 1: Resumen Ejecutivo (KPIs) -->
                                <page name="kpi_summary" string="üìä Resumen">
                                    <group col="4">
                                        <group string="Progreso General" colspan="2">
                                            <field name="completion_rate" widget="progressbar" />
                                            <field name="academic_progress_percentage"
                                                widget="progressbar" />
                                            <field name="average_grade" widget="float" />
                                            <field name="average_attendance" widget="progressbar" />
                                        </group>
                                        <group string="Asignaturas" colspan="2">
                                            <field name="total_subjects_in_plan" readonly="1" />
                                            <field name="completed_subjects_count" readonly="1" />
                                            <field name="in_progress_subjects_count" readonly="1" />
                                            <field name="pending_subjects_count" readonly="1" />
                                            <field name="failed_subjects_count" readonly="1" />
                                        </group>
                                    </group>
                                    <group col="4">
                                        <group string="Horas Acad√©micas" colspan="2">
                                            <field name="completed_hours" readonly="1" />
                                            <field name="total_plan_hours" readonly="1" />
                                        </group>
                                        <group string="Asistencia" colspan="2">
                                            <field name="total_classes_attended" readonly="1" />
                                            <field name="total_classes_scheduled" readonly="1" />
                                        </group>
                                    </group>
                                    <group col="4">
                                        <group string="Matr√≠culas" colspan="2">
                                            <field name="total_enrollments" readonly="1" />
                                            <field name="completed_enrollments" readonly="1" />
                                            <field name="failed_enrollments" readonly="1" />
                                        </group>
                                        <group string="Congelamiento" colspan="2">
                                            <field name="dias_congelamiento_usados" readonly="1" />
                                            <field name="dias_congelamiento_disponibles"
                                                readonly="1" />
                                            <field name="tiene_congelamiento_activo" readonly="1" />
                                        </group>
                                    </group>
                                </page>

                                <!-- Tab 2: Estructura del Plan -->
                                <page name="plan_structure" string="üóÇÔ∏è Plan">
                                    <!-- Mostrar plan desde matr√≠cula activa -->
                                    <div class="alert alert-info" role="alert"
                                        invisible="not active_enrollment_ids">
                                        <strong>Plan de Estudios (desde matr√≠cula activa):</strong>
                                        <br />
                                        <field name="active_enrollment_ids" invisible="1" />
                                        <span invisible="not active_enrollment_ids">
                                            Ver informaci√≥n en la pesta√±a "Matr√≠culas en Curso"
                                        </span>
                                    </div>

                                    <div class="alert alert-warning" role="alert"
                                        invisible="plan_id or active_enrollment_ids">
                                        <strong>‚ö†Ô∏è Sin Plan Asignado:</strong> El estudiante no
                                        tiene matr√≠cula activa. El plan se asigna al crear una
                                        matr√≠cula. </div>

                                    <!-- Informaci√≥n b√°sica del plan -->
                                    <group string="Informaci√≥n del Plan" invisible="not plan_id">
                                        <group>
                                            <field name="program_id" readonly="1" />
                                            <field name="plan_id" readonly="1" />
                                        </group>
                                        <group>
                                            <field name="current_phase_id" readonly="1" />
                                            <field name="current_level_id" readonly="1" />
                                            <field name="current_subject_id" readonly="1" />
                                        </group>
                                    </group>

                                    <!-- Bot√≥n para ver detalles del plan -->
                                    <div invisible="not plan_id" class="mt16">
                                        <button name="action_view_plan_details"
                                            type="object"
                                            string="Ver Estructura Completa del Plan"
                                            class="btn-primary"
                                            invisible="not plan_id"
                                            icon="fa-sitemap" />
                                    </div>
                                </page>

                                <!-- Tab 3: Avance por Asignatura -->
                                <page name="subject_progress" string="üìà Avance">
                                    <div class="alert alert-info" role="alert">
                                        <strong>Progreso por Asignatura:</strong> Detalle del avance
                                        en cada asignatura del plan de estudios. </div>

                                    <!-- Obtener progreso desde la matr√≠cula activa -->
                                    <field name="active_enrollment_ids" invisible="1" />

                                    <group string="Progreso en Asignaturas"
                                        invisible="not active_enrollment_ids">
                                        <!-- Mostrar enrollment_progress_ids de la matr√≠cula activa -->
                                        <field name="active_enrollment_ids" nolabel="1">
                                            <list string="Matr√≠culas en Curso" open_form_view="True">
                                                <field name="code" />
                                                <field name="plan_id" />
                                                <field name="current_subject_id"
                                                    string="Asignatura Actual" />
                                                <field name="state" widget="badge" />
                                            </list>
                                        </field>
                                    </group>

                                    <div class="alert alert-warning" role="alert"
                                        invisible="active_enrollment_ids">
                                        <strong>‚ö†Ô∏è Sin Matr√≠culas en Curso:</strong> El estudiante
                                        no tiene matr√≠culas en curso actualmente. </div>
                                </page>

                                <!-- Tab 4: Asistencia -->
                                <page name="attendance_history" string="üìÖ Asistencia / Notas">
                                    <div class="alert alert-info" role="alert">
                                        <strong>Asignaturas del Plan:</strong> Muestra TODAS las
                                        asignaturas del plan. El estudiante est√° en: <field
                                            name="program_id" readonly="1" nolabel="1" /> / <field
                                            name="plan_id" readonly="1" nolabel="1" /> / <field
                                            name="current_phase_id" readonly="1" nolabel="1" />
                                    </div>

                                    <field name="plan_id" invisible="1" />
                                    <field name="subject_ids" invisible="1" />

                                    <div class="alert alert-warning" role="alert"
                                        invisible="plan_id">
                                        ‚ö†Ô∏è El estudiante a√∫n no tiene un plan asignado. </div>

                                    <!-- Lista √∫nica de todas las sesiones -->
                                    <field name="session_tracking_ids" nolabel="1"
                                        context="{'default_student_id': id}"
                                        domain="[('student_id', '=', id)]">
                                        <list string="Asignaturas"
                                            editable="bottom"
                                            decoration-success="state == 'registered' and attended == True"
                                            decoration-danger="state == 'registered' and attended == False"
                                            decoration-muted="state == 'pending'">
                                            <field name="session_code" string="C√≥digo Sesi√≥n"
                                                readonly="1" />
                                            <field name="phase_id" string="Fase" readonly="1" />
                                            <field name="subject_id" string="Asignatura"
                                                readonly="1" />
                                            <field name="state" string="Estado" widget="badge"
                                                readonly="1" />
                                            <field name="attended" string="Asisti√≥"
                                                widget="boolean_toggle" />
                                            <field name="grade" string="Calificaci√≥n" />
                                            <field name="teacher_id" string="Docente" />
                                            <field name="notes" string="Observaciones" />
                                        </list>
                                    </field>
                                </page>

                                <!-- Tab 5: L√≠nea de Tiempo -->
                                <page name="timeline" string="üïê L√≠nea de Tiempo">
                                    <div class="alert alert-info" role="alert">
                                        <strong>L√≠nea de Tiempo:</strong> Cronolog√≠a de eventos
                                        acad√©micos (matr√≠culas, avances, completaciones). </div>

                                    <!-- Historial cronol√≥gico de matr√≠culas -->
                                    <field name="enrollment_ids" nolabel="1">
                                        <list string="Historial Cronol√≥gico" open_form_view="True"
                                            decoration-success="state in ['completed', 'finished']"
                                            decoration-danger="state == 'failed'"
                                            decoration-muted="state in ['withdrawn', 'cancelled']"
                                            decoration-warning="state in ['active', 'in_progress']">
                                            <field name="enrollment_date" string="Fecha" />
                                            <field name="code" />
                                            <field name="state" widget="badge" />
                                        </list>
                                    </field>

                                    <!-- Historial de cambios de estado (acceso r√°pido) -->
                                    <group string="Historial de Estados" col="1">
                                        <div class="alert alert-info" role="alert">
                                            Use el bot√≥n para abrir el historial de cambios en una
                                            ventana separada.
                                        </div>
                                        <group>
                                            <button name="action_view_lifecycle_history"
                                                type="object"
                                                string="Ver Historial de Estados"
                                                class="btn-primary" />
                                        </group>
                                    </group>
                                </page>
                            </notebook>
                        </page>

                        <!-- Asignaturas Aprobadas (mantener para compatibilidad) -->
                        <page name="approved_subjects" string="‚úÖ Asignaturas Aprobadas">
                            <field name="approved_subject_ids" nolabel="1">
                                <list string="Asignaturas Aprobadas">
                                    <field name="code" />
                                    <field name="name" />
                                    <field name="level_id" />
                                    <field name="phase_id" />
                                    <field name="hours" />
                                    <field name="credits" />
                                </list>
                            </field>
                        </page>

                        <!-- P√°gina de Contacto de Emergencia -->
                        <page name="emergency_contact" string="üö® Contacto de Emergencia">
                            <group>
                                <group>
                                    <field name="emergency_contact_name" />
                                    <field name="emergency_contact_relationship" />
                                </group>
                                <group>
                                    <field name="emergency_contact_phone" widget="phone" />
                                </group>
                            </group>
                        </page>

                        <!-- P√°gina de Estado de Perfil y Congelamiento-->
                        <page name="profile_freeze" string="‚è∏Ô∏è Estado y Congelamiento">
                            <div class="alert alert-info" role="alert">
                                <strong>Estado del estudiante</strong> = ciclo de vida (prospecto,
                                matriculado, activo, etc.).<br />
                                <strong>Estado de perfil</strong> =
                                permisos y restricciones (agendar, asistir, apps). </div>
                            <group string="Estado de Perfil">
                                <group>
                                    <field name="profile_state_id" />
                                    <field name="motivo_bloqueo"
                                        invisible="not profile_state_id or not profile_state_id.requires_reason" />
                                </group>
                                <group>
                                    <field name="al_dia_en_pagos" />
                                    <field name="fecha_ultima_mora" invisible="al_dia_en_pagos" />
                                </group>
                            </group>
                            <group string="Congelamiento">
                                <group>
                                    <field name="dias_congelamiento_usados" />
                                    <field name="dias_congelamiento_disponibles" />
                                </group>
                                <group>
                                    <field name="tiene_congelamiento_activo" />
                                    <button name="action_request_freeze" type="object"
                                        string="Solicitar Congelamiento" class="btn-primary"
                                        invisible="tiene_congelamiento_activo or dias_congelamiento_disponibles == 0" />
                                </group>
                            </group>
                            <field name="freeze_period_ids" nolabel="1">
                                <list string="Historial de Congelamientos"
                                    decoration-success="estado == 'aprobado'"
                                    decoration-warning="estado == 'pendiente'"
                                    decoration-muted="estado in ('rechazado', 'cancelado', 'finalizado')">
                                    <field name="fecha_solicitud" />
                                    <field name="fecha_inicio" />
                                    <field name="fecha_fin" />
                                    <field name="dias" />
                                    <field name="estado" widget="badge" />
                                    <field name="es_especial" optional="show" />
                                </list>
                            </field>
                        </page>

                        <!-- P√°gina de Historial (simplificada para evitar validaci√≥n de vistas
                        anidadas) -->
                        <page name="history" string="üïò Historial">
                            <group col="1">
                                <group>
                                    <div class="alert alert-info" role="alert">
                                        El historial detallado se muestra en ventanas separadas para
                                        evitar validaciones de vista desde el formulario del
                                        estudiante.
                                    </div>
                                </group>
                                <group>
                                    <button name="action_view_lifecycle_history" type="object"
                                        string="Ver Historial de Estados" class="btn-primary" />
                                </group>
                            </group>
                        </page>

                        <!-- P√°gina de Notas y Observaciones -->
                        <page name="notes" string="üìù Notas">
                            <group>
                                <field name="notes"
                                    placeholder="Observaciones generales sobre el estudiante..."
                                    nolabel="1" />
                                <field name="medical_notes"
                                    placeholder="Informaci√≥n m√©dica relevante (alergias, condiciones especiales, etc.)"
                                    nolabel="1" />
                            </group>
                        </page>

                        <!-- P√°gina de Control -->
                        <page name="control" string="‚öôÔ∏è Control"
                            groups="benglish_academy.group_academic_coordinator">
                            <group>
                                <group>
                                    <field name="active" />
                                    <field name="user_id" />
                                    <field name="partner_id" />
                                </group>
                                <group>
                                    <field name="withdrawal_date" readonly="1" />
                                    <field name="withdrawal_reason" readonly="1" />
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter />
            </form>
        </field>
    </record>

    <!-- VISTA KANBAN  -->
    <record id="view_student_kanban" model="ir.ui.view">
        <field name="name">benglish.student.kanban</field>
        <field name="model">benglish.student</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" sample="1">
                <field name="id" />
                <field name="name" />
                <field name="code" />
                <field name="email" />
                <field name="mobile" />
                <field name="program_id" />
                <field name="current_level_id" />
                <field name="active_enrollments" />
                <field name="state" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name" />
                                    </strong>
                                    <div class="o_kanban_record_subtitle">
                                        <field name="code" /> - <field name="program_id" />
                                    </div>
                                </div>
                                <field name="state" widget="label_selection"
                                    options="{'classes': {'active': 'success', 'enrolled': 'info', 'graduated': 'primary'}}" />
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="email" widget="email" />
                                <field name="mobile" widget="phone" />
                                <div>
                                    <span class="badge badge-pill badge-info">
                                        <i class="fa fa-book" /> <field name="active_enrollments" />
                                        Matr√≠culas </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- VISTA DE B√öSQUEDA  -->
    <record id="view_student_search" model="ir.ui.view">
        <field name="name">benglish.student.search</field>
        <field name="model">benglish.student</field>
        <field name="arch" type="xml">
            <search string="Buscar Estudiantes">
                <!-- B√∫squeda -->
                <field name="name" string="Nombre o C√≥digo"
                    filter_domain="['|', ('name', 'ilike', self), ('code', 'ilike', self)]" />
                <field name="code" />
                <field name="email" />
                <field name="student_id_number" />
                <field name="program_id" />
                <field name="current_level_id" />
                <field name="preferred_campus_id" />

                <!-- Filtros -->
                <filter name="filter_active" string="Activos"
                    domain="[('state', '=', 'active')]" />
                <filter name="filter_enrolled" string="Matriculados"
                    domain="[('state', '=', 'enrolled')]" />
                <filter name="filter_prospect" string="Prospectos"
                    domain="[('state', '=', 'prospect')]" />
                <separator />
                <filter name="filter_with_active_enrollments" string="Con Matr√≠culas en Curso"
                    domain="[('active_enrollment_ids', '!=', False)]" />
                <filter name="filter_graduated" string="Graduados"
                    domain="[('state', '=', 'graduated')]" />
                <filter name="filter_withdrawn" string="Retirados"
                    domain="[('state', '=', 'withdrawn')]" />
                <separator />
                <filter name="filter_inactive" string="Archivados"
                    domain="[('active', '=', False)]" />

                <!-- Agrupaci√≥n -->
                <group expand="0" string="Agrupar Por">
                    <filter name="group_program" string="Programa"
                        context="{'group_by': 'program_id'}" />
                    <filter name="group_level" string="Nivel Actual"
                        context="{'group_by': 'current_level_id'}" />
                    <filter name="group_campus" string="Sede Principal"
                        context="{'group_by': 'preferred_campus_id'}" />
                    <filter name="group_state" string="Estado"
                        context="{'group_by': 'state'}" />
                </group>
            </search>
        </field>
    </record>

    <!-- ACCI√ìN -->
    <record id="action_student" model="ir.actions.act_window">
        <field name="name">Estudiantes</field>
        <field name="res_model">benglish.student</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{
            'search_default_filter_active': 1,
            }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Registrar un nuevo estudiante
            </p>
            <p>
                Registre estudiantes con su informaci√≥n personal, acad√©mica y de contacto.
                Luego podr√° matricularlos en grupos y hacer seguimiento de su progreso.
            </p>
        </field>
    </record>

</odoo>