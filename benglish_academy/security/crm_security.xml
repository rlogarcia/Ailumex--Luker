<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========================================
         GRUPOS DE SEGURIDAD CRM
         ======================================== -->

    <!-- Grupo: Asesor Comercial (solo ve sus leads) -->
    <record id="group_crm_advisor" model="res.groups">
        <field name="name">Asesor Comercial</field>
        <field name="category_id" ref="base.module_category_sales_sales" />
        <field name="implied_ids" eval="[(4, ref('crm.group_use_lead'))]" />
        <field name="comment">
            Asesor comercial con acceso limitado:
            - Solo puede ver y editar sus propios leads
            - No puede modificar la fuente del lead
            - No puede cambiar el responsable una vez asignado
        </field>
    </record>

    <!-- ========================================
         RECORD RULES: Protección de fuente
         ======================================== -->

    <!-- Regla: Asesores NO pueden modificar la fuente del lead -->
    <record id="rule_crm_lead_advisor_no_source_write" model="ir.rule">
        <field name="name">Asesor: Sin modificación de fuente</field>
        <field name="model_id" ref="crm.model_crm_lead" />
        <field name="groups" eval="[(4, ref('group_crm_advisor'))]" />
        <field name="perm_read">True</field>
        <field name="perm_write">True</field>
        <field name="perm_create">True</field>
        <field name="perm_unlink">False</field>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
    </record>

    <!-- Regla: Solo managers pueden eliminar leads -->
    <record id="rule_crm_lead_manager_delete" model="ir.rule">
        <field name="name">Manager: Eliminar leads</field>
        <field name="model_id" ref="crm.model_crm_lead" />
        <field name="groups" eval="[(4, ref('sales_team.group_sale_manager'))]" />
        <field name="perm_read">True</field>
        <field name="perm_write">True</field>
        <field name="perm_create">True</field>
        <field name="perm_unlink">True</field>
        <field name="domain_force">[(1, '=', 1)]</field>
    </record>

</odoo>