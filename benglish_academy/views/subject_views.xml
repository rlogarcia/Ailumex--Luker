<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Vista list (Lista) de Asignaturas -->
        <record id="view_benglish_subject_list" model="ir.ui.view">
            <field name="name">benglish.subject.list</field>
            <field name="model">benglish.subject</field>
            <field name="arch" type="xml">
                <list string="Asignaturas" default_order="level_id, sequence, name"
                    decoration-muted="not active"
                    decoration-primary="subject_type == 'core'"
                    decoration-info="subject_type == 'elective'"
                    decoration-warning="prerequisite_count &gt; 0">
                    <header>
                        <button name="action_fix_classifications" type="object"
                            string="ðŸ”§ Corregir Clasificaciones" class="btn-warning"
                            help="Actualiza las clasificaciones de todas las asignaturas segÃºn su categorÃ­a" />
                    </header>
                    <field name="sequence" widget="handle" />
                    <field name="code" />
                    <field name="name" />
                    <field name="level_id" />
                    <field name="phase_id" />
                    <field name="subject_type" widget="badge"
                        decoration-success="subject_type == 'core'"
                        decoration-info="subject_type == 'elective'" />
                    <field name="subject_classification" widget="badge"
                        decoration-success="subject_classification == 'regular'"
                        decoration-warning="subject_classification == 'prerequisite'"
                        decoration-info="subject_classification == 'evaluation'" />
                    <field name="hours" />
                    <field name="duration_hours" optional="show" />
                    <field name="credits" />
                    <field name="prerequisite_count" string="Prereq." />
                    <field name="active" invisible="1" />
                    <button name="action_view_prerequisites" type="object" string="Prerrequisitos"
                        class="btn-warning" icon="fa-link"
                        invisible="prerequisite_count == 0" />
                </list>
            </field>
        </record>

        <!-- Vista Form (Formulario) de Asignaturas -->
        <record id="view_benglish_subject_form" model="ir.ui.view">
            <field name="name">benglish.subject.form</field>
            <field name="model">benglish.subject</field>
            <field name="arch" type="xml">
                <form string="Asignatura">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_prerequisites" type="object"
                                class="oe_stat_button" icon="fa-link"
                                style="background-color: #ffc107; color: black;"
                                invisible="prerequisite_count == 0">
                                <field name="prerequisite_count" widget="statinfo"
                                    string="Prerrequisitos" />
                            </button>
                            <button name="action_view_dependents" type="object"
                                class="oe_stat_button" icon="fa-sitemap"
                                style="background-color: #dc3545; color: white;"
                                invisible="dependent_count == 0">
                                <field name="dependent_count" widget="statinfo"
                                    string="Dependientes" />
                            </button>
                        </div>
                        <widget name="web_ribbon" title="Archivado" bg_color="text-bg-danger"
                            invisible="active" />
                        <div class="oe_title">
                            <group>
                                <group>
                                    <div class="badge text-bg-dark"
                                        style="display: inline-flex; align-items: center; gap: 6px;">
                                        <i class="fa fa-tag" />
                                        <field name="code" placeholder="CÃ³digo" />
                                    </div>
                                </group>
                                <group>
                                    <field name="active" widget="boolean_toggle" />
                                </group>
                            </group>
                        </div>
                        <group>
                            <group>
                                <div>
                                    <label for="name" class="oe_edit_only" />
                                    <h2>
                                        <field name="name" placeholder="Ej: Grammar Fundamentals" />
                                    </h2>
                                </div>
                            </group>
                            <group>
                                <div>
                                    <label for="alias" class="oe_edit_only" />
                                    <h2>
                                        <field name="alias" placeholder="Alias" />
                                    </h2>
                                </div>
                            </group>
                        </group>
                        <group>
                            <group>
                                <div>
                                    <label for="level_id" />
                                    <field name="level_id" options="{'no_create': True}"
                                        placeholder="Seleccione Nivel" />
                                </div>
                            </group>
                            <group>
                                <div>
                                    <label for="subject_classification" />
                                    <field name="subject_classification" widget="radio"
                                        options="{'horizontal': true}" />
                                </div>
                                <field name="evaluable" />
                            </group>
                        </group>
                        <group>
                            <group string="ðŸ›ï¸ UbicaciÃ³n Curricular">
                                <field name="phase_id" readonly="1" />
                                <field name="plan_ids" widget="many2many_tags" readonly="1" />
                                <field name="program_id" readonly="1" />
                            </group>
                            <group string="ðŸ“Š Carga AcadÃ©mica">
                                <field name="hours" string="Horas" />
                                <field name="duration_hours" string="DuraciÃ³n (Horas)" />
                                <field name="credits" string="CrÃ©ditos" />
                            </group>
                        </group>
                        <notebook>
                            <page string="DescripciÃ³n">
                                <field name="description"
                                    placeholder="DescripciÃ³n de la asignatura, objetivos, contenido temÃ¡tico..." />
                            </page>
                            <page string="ðŸ”— Prerrequisitos" name="prerequisites">
                                <div class="alert alert-warning mb-3" role="alert">
                                    <h5>
                                        <i class="fa fa-link" />
                                        <strong>Prerrequisitos AcadÃ©micos</strong>
                                    </h5>
                                    <p>Asignaturas que el estudiante <strong>debe aprobar antes</strong>
                                        de matricularse en Ã©sta.</p>
                                    <hr />
                                    <small>
                                        <i class="fa fa-check-circle" /> Los prerrequisitos deben
                                        pertenecer al mismo programa<br />
                                        <i
                                            class="fa fa-check-circle" /> Deben ser de niveles
                                        anteriores o del mismo nivel<br />
                                        <i class="fa fa-ban" /> No
                                        se permiten ciclos de dependencia </small>
                                </div>
                                <group>
                                    <field name="prerequisite_ids" nolabel="1"
                                        widget="many2many_tags">
                                        <list>
                                            <field name="code" />
                                            <field name="name" />
                                            <field name="level_id" />
                                            <field name="phase_id" />
                                        </list>
                                    </field>
                                </group>
                            </page>
                            <page string="ðŸŽ¯ Dependientes" name="dependents"
                                invisible="dependent_count == 0">
                                <div class="alert alert-info mb-3" role="alert">
                                    <h5>
                                        <i class="fa fa-sitemap" />
                                        <strong>Asignaturas Dependientes</strong>
                                    </h5>
                                    <p>Estas asignaturas <strong>requieren aprobar la actual</strong>
                                        como prerrequisito.</p>
                                </div>
                                <field name="dependent_subject_ids" nolabel="1" readonly="1">
                                    <list>
                                        <field name="code" />
                                        <field name="name" />
                                        <field name="level_id" />
                                        <field name="phase_id" />
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter />
                </form>
            </field>
        </record>

        <!-- Vista Kanban de Asignaturas -->
        <record id="view_benglish_subject_kanban" model="ir.ui.view">
            <field name="name">benglish.subject.kanban</field>
            <field name="model">benglish.subject</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" create="false">
                    <field name="name" />
                    <field name="code" />
                    <field name="level_id" />
                    <field name="phase_id" />
                    <field name="subject_type" />
                    <field name="hours" />
                    <field name="credits" />
                    <field name="prerequisite_count" />
                    <field name="active" />
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings"
                                        style="display:flex; flex-direction:column; align-items:flex-start;">
                                        <div
                                            style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                                            <strong class="o_kanban_record_title"
                                                style="display:inline-block;">
                                                <field name="name" />
                                            </strong>
                                            <span t-if="record.subject_type.raw_value == 'core'"
                                                class="badge text-bg-success"
                                                style="margin-left:8px;">Obligatoria</span>
                                            <span t-if="record.subject_type.raw_value == 'elective'"
                                                class="badge text-bg-info" style="margin-left:8px;">
                                                Electiva</span>
                                        </div>
                                        <div style="margin-top: 4px; width:100%;">
                                            <span class="badge text-bg-dark"
                                                style="font-size:13px; color:#fff; display:inline-block; width:auto;">
                                                <field name="code" />
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <field name="level_id" />
                                    </div>
                                    <div class="text-muted">
                                        <field name="phase_id" />
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge text-bg-primary me-1">
                                            <i class="fa fa-clock-o" /> <field name="hours" /> hrs </span>
                                        <span class="badge text-bg-secondary me-1">
                                            <i class="fa fa-certificate" /> <field name="credits" />
                                            crÃ©ditos </span>
                                        <span t-if="record.prerequisite_count.raw_value &gt; 0"
                                            class="badge text-bg-warning">
                                            <i class="fa fa-link" /> <field name="prerequisite_count" />
                                            prereq. </span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Vista de BÃºsqueda de Asignaturas -->
        <record id="view_benglish_subject_search_v2" model="ir.ui.view">
            <field name="name">benglish.subject.search.v2</field>
            <field name="model">benglish.subject</field>
            <field name="arch" type="xml">
                <search string="Buscar Asignaturas">
                    <field name="name" string="Asignatura"
                        filter_domain="['|', ('name', 'ilike', self), ('code', 'ilike', self)]" />
                    <field name="code" />
                    <field name="level_id" />
                    <field name="phase_id" />
                    <field name="program_id" />
                    <separator />
                    <filter string="Activos" name="active" domain="[('active', '=', True)]" />
                    <filter string="Archivados" name="inactive" domain="[('active', '=', False)]" />
                    <separator />
                    <filter string="Obligatorias" name="core"
                        domain="[('subject_type', '=', 'core')]" />
                    <filter string="Electivas" name="elective"
                        domain="[('subject_type', '=', 'elective')]" />
                    <filter string="Con Prerrequisitos" name="with_prerequisites"
                        domain="[('prerequisite_count', '>', 0)]" />
                    <group expand="0" string="Agrupar por">
                        <filter string="Nivel" name="group_by_level"
                            context="{'group_by': 'level_id'}" />
                        <filter string="Fase" name="group_by_phase"
                            context="{'group_by': 'phase_id'}" />
                        <filter string="Tipo" name="group_by_type"
                            context="{'group_by': 'subject_type'}" />
                        <filter string="Programa" name="group_by_program"
                            context="{'group_by': 'program_id'}" />
                    </group>
                </search>
            </field>
        </record>

        <!-- AcciÃ³n de Servidor para Corregir Clasificaciones -->
        <record id="action_server_fix_classifications" model="ir.actions.server">
            <field name="name">ðŸ”§ Corregir Clasificaciones</field>
            <field name="model_id" ref="model_benglish_subject" />
            <field name="binding_model_id" ref="model_benglish_subject" />
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
                action = records.action_fix_classifications()
            </field>
        </record>

        <!-- AcciÃ³n de Ventana para Asignaturas -->
        <record id="action_benglish_subject" model="ir.actions.act_window">
            <field name="name">Asignaturas</field>
            <field name="res_model">benglish.subject</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="domain">[('active', '=', True)]</field>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    ðŸ“– Crear tu primera Asignatura
                </p>
                <p>
                    <strong>Las asignaturas</strong> son las unidades curriculares que componen cada
                    nivel.<br /> ðŸ’¡ <em>Puedes definir prerrequisitos entre asignaturas para
                    controlar el flujo acadÃ©mico y asegurar que los estudiantes cursen las materias
                    en el orden correcto.</em>
                </p>
            </field>
        </record>

    </data>
</odoo>